---
import Layout from '../layouts/Layout.astro';
import MaintenanceList from '../components/MaintenanceList';
import CreditSystem from '../components/CreditSystem';
import GardenMap from '../components/GardenMap';

// PLACEHOLDER: Initial tasks - diese sollten aus der DB kommen
const maintenanceCategories = [
  {
    id: 'rasen',
    name: 'Rasenpflege',
    emoji: 'üåø',
    tasks: [
      { id: 1, title: 'Rasenm√§hen', cycleDays: 14, creditValue: 15, description: 'Gesamter Rasen m√§hen und Schnittgut entsorgen' },
      { id: 2, title: 'Rasenkanten schneiden', cycleDays: 30, creditValue: 10, description: 'Kanten entlang der Beete und Wege' },
      { id: 3, title: 'Vertikutieren', cycleDays: 180, creditValue: 30, description: 'Rasen vertikutieren (Fr√ºhjahr/Herbst)' },
    ]
  },
  {
    id: 'beete',
    name: 'Beetarbeiten',
    emoji: 'üåª',
    tasks: [
      { id: 4, title: 'Unkraut j√§ten', cycleDays: 14, creditValue: 20, description: 'Alle Beete von Unkraut befreien' },
      { id: 5, title: 'Beete mulchen', cycleDays: 365, creditValue: 40, description: 'Rindenmulch aufbringen' },
      { id: 6, title: 'Blumen gie√üen', cycleDays: 3, creditValue: 5, description: 'Bei Trockenheit gie√üen' },
    ]
  },
  {
    id: 'baeume',
    name: 'B√§ume & Hecken',
    emoji: 'üå≥',
    tasks: [
      { id: 7, title: 'Hecke schneiden', cycleDays: 90, creditValue: 35, description: 'Hecken in Form schneiden' },
      { id: 8, title: 'Obstbaumschnitt', cycleDays: 365, creditValue: 50, description: 'Winterschnitt der Obstb√§ume' },
      { id: 9, title: 'Laub harken', cycleDays: 7, creditValue: 15, description: 'Laub zusammenharken (Herbst)' },
    ]
  },
  {
    id: 'brennholz',
    name: 'Brennholz',
    emoji: 'ü™µ',
    tasks: [
      { id: 10, title: 'Holz hacken', cycleDays: 180, creditValue: 40, description: 'Holz f√ºr Feuerstelle hacken' },
      { id: 11, title: 'Holz stapeln', cycleDays: 180, creditValue: 25, description: 'Gehacktes Holz ordentlich stapeln' },
      { id: 12, title: 'Holzvorrat pr√ºfen', cycleDays: 30, creditValue: 5, description: 'Bestand kontrollieren' },
    ]
  },
  {
    id: 'elektrik',
    name: 'Elektrik',
    emoji: '‚ö°',
    tasks: [
      { id: 13, title: 'Au√üenbeleuchtung pr√ºfen', cycleDays: 90, creditValue: 10, description: 'Alle Lampen testen, defekte austauschen' },
      { id: 14, title: 'Steckdosen pr√ºfen', cycleDays: 180, creditValue: 15, description: 'Au√üensteckdosen auf Funktion pr√ºfen' },
      { id: 15, title: 'E-Check (Elektriker)', cycleDays: 730, creditValue: 0, description: 'Professionelle Pr√ºfung - Dienstleister beauftragen' },
    ]
  },
  {
    id: 'putzen',
    name: 'Reinigung',
    emoji: 'üßπ',
    tasks: [
      { id: 16, title: 'Gartenhaus putzen', cycleDays: 30, creditValue: 25, description: 'Innenreinigung des Gartenhauses' },
      { id: 17, title: 'Terrasse reinigen', cycleDays: 60, creditValue: 20, description: 'Terrassenplatten abkehren/schrubben' },
      { id: 18, title: 'Regenrinnen reinigen', cycleDays: 180, creditValue: 20, description: 'Laub aus Regenrinnen entfernen' },
      { id: 19, title: 'Fenster putzen', cycleDays: 90, creditValue: 15, description: 'Fenster des Gartenhauses reinigen' },
    ]
  },
  {
    id: 'sonstiges',
    name: 'Sonstiges',
    emoji: 'üîß',
    tasks: [
      { id: 20, title: 'Werkzeug pflegen', cycleDays: 180, creditValue: 15, description: 'Werkzeuge reinigen und √∂len' },
      { id: 21, title: 'Zaun kontrollieren', cycleDays: 90, creditValue: 10, description: 'Zaunpf√§hle und Latten pr√ºfen' },
      { id: 22, title: 'Winterfest machen', cycleDays: 365, creditValue: 50, description: 'Wasserhahn abstellen, M√∂bel einr√§umen (Herbst)' },
      { id: 23, title: 'Fr√ºhjahrs-Check', cycleDays: 365, creditValue: 50, description: 'Alles nach dem Winter √ºberpr√ºfen (Fr√ºhjahr)' },
    ]
  }
];

// EINMALIGE AUFGABEN - Infrastruktur-Projekte (nicht wiederkehrend)
const einmaligeAufgaben = [
  {
    id: 'wasser',
    name: 'Wasser-Infrastruktur',
    emoji: 'üíß',
    tasks: [
      { id: 100, title: 'Hydrophoranlage erneuern (250l)', description: 'Hydrophoranlage im Duschraum erneuern f√ºr frostsicheren Betrieb von K√ºche und Dusche. Klempnerarbeit erforderlich.', priority: 'hoch', estimatedCost: '500-800‚Ç¨' },
      { id: 101, title: 'Wasserverteilung im Keller √ºberarbeiten', description: 'Erneuerungsbed√ºrftige Verteilung im Duschraum (Keller) neu machen.', priority: 'mittel', estimatedCost: '300-500‚Ç¨' },
      { id: 102, title: 'Automatische Bew√§sserung fertigstellen', description: 'Vorinstallierte Bew√§sserung f√ºr Beete, Weinberg etc. funktioniert nur unzureichend. Beh√§lter: 1000l Vroni-Schuppen, 1000l Carport, 1000l oberer Schuppen, 600l Konnys Schuppen.', priority: 'niedrig', estimatedCost: '200-400‚Ç¨' },
    ]
  },
  {
    id: 'elektrik-einmalig',
    name: 'Elektrik-Projekte',
    emoji: '‚ö°',
    tasks: [
      { id: 103, title: 'Erdung installieren', description: 'WICHTIG: Anlage hat keine Erdung! Erdstab kann im Keller in die Grundplatte gebohrt werden.', priority: 'kritisch', estimatedCost: '100-200‚Ç¨' },
      { id: 104, title: 'Hausverkabelung auf 220V erneuern', description: 'Aktuelle Kabel nicht 220V tauglich. Alle Kabel im Zwischenboden - mit alten kann man neue durchziehen. Eigenleistung: Moritz, Matti', priority: 'hoch', estimatedCost: '300-500‚Ç¨' },
      { id: 105, title: 'Steckdosen installieren', description: 'Zus√§tzliche Steckdosen im Haus installieren.', priority: 'mittel', estimatedCost: '100-200‚Ç¨' },
      { id: 106, title: 'Balkonanlage mit Batterie kaufen', description: 'Zwei 220V~ Anlagen betreiben: eine f√ºr Haus, eine f√ºr Gartenger√§te.', priority: 'mittel', estimatedCost: '800-1500‚Ç¨' },
      { id: 107, title: 'Elektriker f√ºr Planung & Abnahme', description: 'Professionelle Planung und Abnahme der Elektroanlage.', priority: 'hoch', estimatedCost: '200-400‚Ç¨' },
    ]
  },
  {
    id: 'haus-einmalig',
    name: 'Haus-Projekte',
    emoji: 'üè†',
    tasks: [
      { id: 108, title: 'K√ºhlschrank in K√ºche unterbringen', description: 'K√ºhlschrank sollte in der K√ºche untergebracht werden.', priority: 'niedrig', estimatedCost: '0‚Ç¨' },
      { id: 109, title: 'Auszieh-Couch besorgen', description: 'F√ºr mehrere √úbernachtungsg√§ste (max. 4 Personen).', priority: 'niedrig', estimatedCost: '300-600‚Ç¨' },
      { id: 110, title: 'Gasbetriebene Dusche reparieren', description: 'Dusche im Kellerraum ist defekt, aber alle Teile sind vorhanden zur Neuinstallation.', priority: 'mittel', estimatedCost: '100-300‚Ç¨' },
    ]
  },
  {
    id: 'garten-einmalig',
    name: 'Garten-Projekte',
    emoji: 'üåø',
    tasks: [
      { id: 111, title: 'Teich fertigstellen', description: 'Teich 10m¬≤, 80cm tief ist ausgehoben und bew√§ssert, aber noch nicht fertiggestellt.', priority: 'niedrig', estimatedCost: '200-500‚Ç¨' },
      { id: 112, title: 'Keller unter Schuppen abdichten', description: 'Keller 8x3mx1,8m als Wasser-Reservoir geplant, muss noch abgedichtet werden. Potenzial f√ºr Sauna mit Schwimmbecken!', priority: 'niedrig', estimatedCost: '1000-2000‚Ç¨' },
    ]
  }
];
---

<Layout title="Wartung" description="Wartungsaufgaben und Guthaben-System f√ºr den Voigt-Garten">
  <!-- Header -->
  <section class="bg-gradient-to-b from-garden-100 to-white py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="font-display text-4xl md:text-5xl font-bold text-garden-900 mb-4">
        Wartung & Pflege
      </h1>
      <p class="text-xl text-garden-700 max-w-2xl mx-auto">
        Alle Arbeiten im √úberblick. Wer hilft, bekommt Guthaben!
      </p>
    </div>
  </section>

  <!-- Stats Bar -->
  <section class="py-6 bg-white border-b border-gray-200">
    <div class="max-w-6xl mx-auto px-4">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
        <div class="bg-red-50 rounded-lg p-4">
          <div class="text-2xl font-bold text-red-600" id="stat-overdue">-</div>
          <div class="text-sm text-red-700">√úberf√§llig</div>
        </div>
        <div class="bg-amber-50 rounded-lg p-4">
          <div class="text-2xl font-bold text-amber-600" id="stat-due-soon">-</div>
          <div class="text-sm text-amber-700">Bald f√§llig</div>
        </div>
        <div class="bg-green-50 rounded-lg p-4">
          <div class="text-2xl font-bold text-green-600" id="stat-ok">-</div>
          <div class="text-sm text-green-700">In Ordnung</div>
        </div>
        <div class="bg-garden-50 rounded-lg p-4">
          <div class="text-2xl font-bold text-garden-600">{maintenanceCategories.reduce((sum, cat) => sum + cat.tasks.length, 0)}</div>
          <div class="text-sm text-garden-700">Gesamt Tasks</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Garden Map -->
  <section class="py-8 bg-gray-50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <GardenMap client:load droneImageUrl="/images/drone-view.jpg" />
    </div>
  </section>

  <!-- Main Content -->
  <section class="py-12">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Task List -->
        <div class="lg:col-span-2">
          <MaintenanceList client:load categories={maintenanceCategories} />
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
          <!-- Credit System -->
          <div id="credits" class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="font-display text-xl font-bold text-garden-900 mb-4">
              üí∞ Guthaben-System
            </h3>
            <CreditSystem client:load />
          </div>

          <!-- How it works -->
          <div class="bg-garden-50 rounded-xl p-6">
            <h3 class="font-semibold text-garden-800 mb-4">So funktioniert's:</h3>
            <ol class="space-y-3 text-sm text-gray-700">
              <li class="flex gap-2">
                <span class="bg-garden-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold">1</span>
                <span>W√§hle eine Aufgabe aus</span>
              </li>
              <li class="flex gap-2">
                <span class="bg-garden-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold">2</span>
                <span>Erledige die Arbeit im Garten</span>
              </li>
              <li class="flex gap-2">
                <span class="bg-garden-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold">3</span>
                <span>Markiere als erledigt (mit Foto)</span>
              </li>
              <li class="flex gap-2">
                <span class="bg-garden-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold">4</span>
                <span>Guthaben wird gutgeschrieben!</span>
              </li>
            </ol>
          </div>

          <!-- Contact for help -->
          <div class="bg-amber-50 rounded-xl p-6 border-2 border-amber-200">
            <h3 class="font-semibold text-amber-800 mb-2">‚ùó Zu viel Arbeit?</h3>
            <p class="text-sm text-amber-700 mb-4">
              Bei √ºberf√§lligen Aufgaben kann automatisch ein Dienstleister angefragt werden.
            </p>
            <a href="/dienstleister" class="text-amber-800 hover:text-amber-900 font-medium text-sm underline">
              Dienstleister ansehen ‚Üí
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Einmalige Aufgaben (Projekte) -->
  <section class="py-12 bg-amber-50 border-t border-amber-100">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-8">
        <div class="inline-flex items-center gap-2 bg-amber-100 text-amber-800 px-4 py-2 rounded-full text-sm font-medium mb-4">
          <span>üî®</span> Infrastruktur-Projekte
        </div>
        <h2 class="font-display text-3xl font-bold text-amber-900 mb-4">
          Einmalige Aufgaben
        </h2>
        <p class="text-amber-700 max-w-2xl mx-auto">
          Diese Projekte sind keine wiederkehrenden Wartungsaufgaben, sondern einmalige Infrastruktur-Verbesserungen.
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {einmaligeAufgaben.map((category) => (
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="font-display text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
              <span>{category.emoji}</span> {category.name}
            </h3>
            <ul class="space-y-3">
              {category.tasks.map((task) => (
                <li class="border-l-4 pl-4 py-2" style={`border-color: ${task.priority === 'kritisch' ? '#ef4444' : task.priority === 'hoch' ? '#f59e0b' : task.priority === 'mittel' ? '#3b82f6' : '#22c55e'}`}>
                  <div class="flex justify-between items-start">
                    <div>
                      <h4 class="font-medium text-gray-900">{task.title}</h4>
                      <p class="text-sm text-gray-600 mt-1">{task.description}</p>
                    </div>
                    <span class={`text-xs px-2 py-1 rounded-full whitespace-nowrap ml-2 ${
                      task.priority === 'kritisch' ? 'bg-red-100 text-red-800' :
                      task.priority === 'hoch' ? 'bg-amber-100 text-amber-800' :
                      task.priority === 'mittel' ? 'bg-blue-100 text-blue-800' :
                      'bg-green-100 text-green-800'
                    }`}>
                      {task.priority}
                    </span>
                  </div>
                  <div class="text-xs text-gray-500 mt-2">
                    Gesch√§tzte Kosten: {task.estimatedCost}
                  </div>
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>

      <div class="mt-8 text-center">
        <p class="text-sm text-amber-600">
          üìã Details zu allen Projekten: <a href="https://github.com/MoritzV42/voigt-garten/tree/main/docs" class="underline hover:text-amber-800">docs/infrastruktur-arbeiten.md</a>
        </p>
      </div>
    </div>
  </section>

  <!-- Claude Integration Info -->
  <section class="py-12 bg-purple-50 border-t border-purple-100">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <div class="inline-flex items-center gap-2 bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm font-medium mb-4">
        <span>ü§ñ</span> KI-unterst√ºtzt
      </div>
      <h2 class="font-display text-2xl font-bold text-purple-900 mb-4">
        Automatische Hilfe bei √ºberf√§lligen Aufgaben
      </h2>
      <p class="text-purple-700 max-w-2xl mx-auto">
        Wenn eine Aufgabe l√§nger als 2 Wochen √ºberf√§llig ist, kann Claude automatisch
        einen passenden Dienstleister kontaktieren. Nat√ºrlich nur nach deiner Freigabe!
      </p>
    </div>
  </section>
</Layout>
